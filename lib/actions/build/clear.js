
// rm all the '__build' directories generated by spm build.

var fs = require('fs');
var path = require('path');

var util = require('../../helper/util');
var CONFIG = require('../../config');


/**
 * Clear spm build temporary files.
 * @param {string} basedir The basedir of spm build working.
 */
exports.run = function(basedir) {
  basedir = basedir || process.cwd();
  console.log('Clearing ' + path.basename(basedir) + '...');
  clear(basedir);
  console.log('Clear successfully.');
};


function clear(basedir) {
  fs.readdirSync(basedir).forEach(function(item) {
    var p = path.join(basedir, item);
    if (item === CONFIG.DEFAULT_BUILD_DIR) {
      util.rmdirForce(p);
    }
    else if (item.indexOf('.') === -1) {
      if (fs.statSync(p).isDirectory()) {
        clear(p);
      }
    }
  });
}
